- render :partial => 'retail/catalogs/main_navigation'

.block
  .secondary-navigation
    %ul.wat-cf
      %li.first.active= link_to "Place New Order", retail_cart_path
  .content
    %h2.title Place New Purchase Order
    .inner
      %p Please confirm the the following products to place your new purchase order.
      - form_for @order, :url => retail_customer_orders_path(current_customer), :html => { :class => :form } do |f|
        .group
          = f.error_messages
        %table.table
          %tr
            %th.first
            %th Title
            %th Packaging
            %th Qty.
            %th{:align => 'right'} Price
            %th.last
          - f.fields_for :items, @order.items.build do |order_item|
            - for item in customer_session[:cart_items]
              = order_item.hidden_field :packaging_option_id, :value => item['packaging_option_id']
              = order_item.hidden_field :product_id, :value => item['product_id']
              = order_item.hidden_field :quantity,   :value => item['quantity']
              %tr{:class => cycle("odd", "even")}
                - product   = Product.find(item['product_id'].to_i)
                - packaging = PackagingOption.find(item['packaging_option_id'])
                %td
                %td= link_to product.title, retail_catalog_product_path(item['catalog_id'],item['product_id'])
                %td= packaging.title
                %td= item['quantity']
                %td= number_to_currency(item['price'].to_f*item['quantity'].to_f + packaging.price)
                %td
          %tr
            %td{:colspan => '3'}
            %td TOTAL
            %td
              %b= number_to_currency(cart_total)
            %td
        .group
          = f.label :card_type, 'Card Type', :class => :label
          = f.select :card_type, [['Visa','visa'], ['MasterCard','mastercard'], ['Discover','discover'], ['American Express', 'american_express']]
        .group
          = f.label :card_number, 'Card Number', :class => :label
          = f.text_field :card_number, :class => 'text_field'
        .group
          = f.label :card_verification, 'Card Verification Value', :class => :label
          = f.text_field :card_verification, :class => 'text_field_small'
        .group
          = f.label :card_expires_on, 'Card Expires On', :class => :label
          = f.date_select :card_expires_on, :discard_day => true, :start_year => Date.today.year, :add_month_numbers => true
        .group
          = f.label :billing_address, "Billing Address", :class => :label
          = f.text_area :billing_address, :rows => 5, :class => 'text_area'
        .group
          = f.label :shipping_address, "Shipping Address", :class => :label
          = f.text_area :shipping_address, :rows => 5, :class => 'text_area'
          %p
            = check_box_tag :same_as, :value => '1'
            Same as Billing Address

        -# hidden fields for helper attr_accessor methods
        = f.hidden_field :first_name, :value => current_customer.first_name
        = f.hidden_field :last_name,  :value => current_customer.last_name
        = f.hidden_field :ip_address, :value => request.remote_ip

        .group.navform.wat-cf
          %button.button{:type => 'submit'}
            = image_tag("web-app-theme/tick.png", :alt => "Place Order")
            Place Order
          = link_to "#{image_tag("web-app-theme/cross.png", :alt => "Cancel")} Cancel", retail_cart_path, :class => "button"

- content_for :sidebar, render(:partial => 'retail/shared/sidebar')

